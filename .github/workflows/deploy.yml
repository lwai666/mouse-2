name: Deploy to Server

on:
  push:
    branches:
      - main  # 这里确保是你的主分支
    paths:
      - 'hid-web/**'  # 只有 hid-web 文件夹下的变更才触发

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Deploy via SSH
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_SSH_KEY }}
          script: |
            export PATH=$HOME/.nvm/versions/node/v22.19.0/bin:$PATH
            /root/.nvm/versions/node/v22.19.0/bin/pm2 stop mouse-hid-backend
            cd ~/mouse-2
            git pull
            cd ~/mouse-2/hid-web
            /root/.nvm/versions/node/v22.19.0/bin/pnpm install
            /root/.nvm/versions/node/v22.19.0/bin/pnpm run build
            /root/.nvm/versions/node/v22.19.0/bin/pm2 start mouse-hid-backend
